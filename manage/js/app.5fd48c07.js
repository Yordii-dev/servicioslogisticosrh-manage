(function(){"use strict";var e={4825:function(e,t,a){var s=a(9242),o=a(3396);function n(e,t){const a=(0,o.up)("router-view");return(0,o.wg)(),(0,o.j4)(a)}var r=a(89);const i={},l=(0,r.Z)(i,[["render",n]]);var c=l,d=a(678),m=a(7139);const u=e=>((0,o.dD)("data-v-06202b42"),e=e(),(0,o.Cn)(),e),p={class:"container-login"},h={class:"form-group form-group-vehicle"},g={class:"d-flex justify-content-end"},v=u((()=>(0,o._)("span",{class:"mx-2 spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1))),f=u((()=>(0,o._)("small",null,"Cargando vehiculos",-1))),_=[v,f],y=["value"],w={class:"vehicleHelp form-text text-muted text-right"},b=u((()=>(0,o._)("br",null,null,-1))),k={class:"form-group"},C=u((()=>(0,o._)("br",null,null,-1))),S={class:"btn-ingresar border-0 text-white w-100 py-2",type:"submit"},I=(0,o.Uk)(" Iniciar sesiÃ³n ");function x(e,t,a,n,r,i){return(0,o.wg)(),(0,o.iD)("div",p,[(0,o._)("form",{class:"mx-3",onSubmit:t[2]||(t[2]=(0,s.iM)(((...e)=>i.validate&&i.validate(...e)),["prevent"]))},[(0,o._)("div",null,[(0,o._)("div",h,[(0,o._)("div",g,[(0,o._)("div",{class:(0,m.C_)(["text-secondary spinner",r.isFetch?"d-none":""])},_,2)]),(0,o.wy)((0,o._)("select",{name:"vehiculo",class:"form-control","aria-describedby":"emailHelp","onUpdate:modelValue":t[0]||(t[0]=e=>r.idVehicle=e),required:""},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.vehicles,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.id,value:e.id},(0,m.zw)(e.placa),9,y)))),128))],512),[[s.bM,r.idVehicle]]),(0,o._)("small",w,(0,m.zw)(0==r.vehicles.length&&r.isFetch?"Sin vehiculos":""),1)]),b,(0,o._)("div",k,[(0,o.wy)((0,o._)("input",{name:"pin",type:"password",class:"form-control border-1 py-4","onUpdate:modelValue":t[1]||(t[1]=e=>r.pin=e),placeholder:"Pin",required:""},null,512),[[s.nr,r.pin]]),r.isFetchUsers?((0,o.wg)(),(0,o.iD)("small",{key:0,class:(0,m.C_)(["pinHelp",r.userExist&&r.isFetchUsers?"":"text-danger"])},(0,m.zw)(r.userExist&&r.isFetchUsers?"":"Pin desconocido"),3)):(0,o.kq)("",!0)])]),C,(0,o._)("button",S,[(0,o._)("span",{class:(0,m.C_)(["spinner-border spinner-border-sm mx-1",r.spinnerButton?"":"d-none"]),role:"status","aria-hidden":"true"},null,2),I])],32),(0,o.wy)((0,o._)("div",{class:"fixed-bottom alert-danger w-100 py-3 text-center"},(0,m.zw)(r.error),513),[[s.F8,0!=r.error]])])}var D={data(){return{userExist:!1,isFetchUsers:!1,isFetch:!1,idVehicle:null,pin:null,spinnerButton:!1,vehicles:[],error:!1}},methods:{async signIn(){try{const e="https://worktrack.apalworkflow.com/server/signinManage";let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({idVehicle:this.idVehicle,pin:this.pin})}),a=await t.json();return a}catch(e){this.error=`Error al obtener usuario: ${e}`}},async validate(){this.spinnerButton=!0;let e=await this.signIn();"undefined"!==typeof e&&(null!==e&&(localStorage.setItem("token_user",e),this.userExist=!0,this.$router.push({name:"route"})),this.isFetchUsers=!0,this.spinnerButton=!1)}},async mounted(){try{const e="https://worktrack.apalworkflow.com/server/vehicles";let t=await fetch(e),a=await t.json();this.vehicles=a,this.isFetch=!0}catch(e){this.error=`Error al obtener vehiculos: ${e}`}}};const E=(0,r.Z)(D,[["render",x],["__scopeId","data-v-06202b42"]]);var M=E;const T=e=>((0,o.dD)("data-v-73b40d9e"),e=e(),(0,o.Cn)(),e),O={class:"container-start"},$={class:"container-check position-relative"},A=T((()=>(0,o._)("div",{class:"check d-flex flex-column align-items-center"},[(0,o._)("i",{class:"fa-solid fa-circle-check"}),(0,o._)("span",{class:"h4"},"Todo Listo!")],-1))),z=T((()=>(0,o._)("hr",null,null,-1))),R={class:"details mx-3 h-50 p-2 justify-content-between d-flex flex-column"},j={class:"fecha d-flex justify-content-between"},N=T((()=>(0,o._)("span",{class:"text-secondary"},"Fecha de Ruta",-1))),B={class:"vehiculo d-flex justify-content-between"},L=T((()=>(0,o._)("span",{class:"text-secondary"},"Vehiculo",-1))),P={class:"entrega d-flex justify-content-between"},U=T((()=>(0,o._)("span",{class:"text-secondary"},"Entregas",-1))),F={class:"hora d-flex justify-content-between"},G=T((()=>(0,o._)("span",{class:"text-secondary"},"Hora de Inicio",-1))),W=["disabled"];function H(e,t,a,n,r,i){const l=(0,o.up)("RowBack");return(0,o.wg)(),(0,o.iD)("div",O,[(0,o.Wm)(l,{class:"container",back:"/"}),(0,o._)("div",$,[A,z,(0,o._)("div",R,[(0,o._)("div",j,[N,(0,o._)("span",{class:(0,m.C_)(r.isStarted?"isStarted":"h6")},(0,m.zw)(r.startDate),3)]),(0,o._)("div",B,[L,(0,o._)("span",{class:(0,m.C_)(r.isStarted?"isStarted":"h6")},(0,m.zw)(r.vehicle),3)]),(0,o._)("div",P,[U,(0,o._)("span",{class:(0,m.C_)(r.isStarted?"isStarted":"h6")},(0,m.zw)(r.deliveriesAmount),3)]),(0,o._)("div",F,[G,(0,o._)("span",{class:(0,m.C_)(r.isStarted?"isStarted":"h6")},(0,m.zw)(r.startHour),3)])]),(0,o._)("button",{onClick:t[0]||(t[0]=(...e)=>i.href&&i.href(...e)),disabled:0==e.deliveries,class:(0,m.C_)([0==e.deliveries?"bg-muted":"bg-primary text-white","h6 fixed-bottom text-center text-decoration-none p-3 border-0"])},[(0,o._)("span",{class:(0,m.C_)(["spinner spinner-border spinner-border-sm",{"d-none":!r.spinnerButton}]),role:"status","aria-hidden":"true"},null,2),(0,o.Uk)(" "+(0,m.zw)(r.isStarted?"CONTINUAR RUTA":"CONFIRMAR E INICIAR RUTA"),1)],10,W)]),(0,o.wy)((0,o._)("div",{class:"fixed-bottom alert-danger w-100 py-3 text-center"},(0,m.zw)(r.error),513),[[s.F8,0!=r.error]])])}const Z={class:"py-2"},V=(0,o._)("i",{class:"fa fa-arrow-left","aria-hidden":"true"},null,-1);function q(e,t,a,s,n,r){const i=(0,o.up)("router-link");return(0,o.wg)(),(0,o.iD)("div",Z,[(0,o.Wm)(i,{class:"h3 mx-2",to:`${a.back}`},{default:(0,o.w5)((()=>[V])),_:1},8,["to"])])}var J={props:["back"]};const K=(0,r.Z)(J,[["render",q]]);var Y=K,X={components:{RowBack:Y},data(){return{spinnerButton:!1,isStarted:!1,fullPage:!0,vehicle:"",startDate:"",deliveriesAmount:"",startHour:"",error:!1}},methods:{actualDate(){const e=new Date,t=60*e.getTimezoneOffset()*1e3,a=new Date(e.getTime()-t),s=a.toISOString().slice(0,19).replace(/-/g,"-").replace("T"," ");return s},async getRoute(){try{const e="https://worktrack.apalworkflow.com/server/route";let t=await fetch(e,{headers:{Authorization:"Bearer "+localStorage.getItem("token_user")}}),a=await t.json();return a}catch(e){this.error=`Error al obtener informacion de ruta: ${e}`}},async startRoute(){try{const e="https://worktrack.apalworkflow.com/server/route";let t=await fetch(e,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token_user")},body:JSON.stringify({fecha:this.startDate,hora:this.startHour})}),a=await t.json();return a}catch(e){this.error=`Error al iniciar ruta: ${e}`}},async href(){if(this.spinnerButton=!0,0==this.isStarted){let e=await this.startRoute();e.affectedRows>0?this.$router.push({name:"deliveries"}):alert("No se puedo crear la ruta!")}else this.$router.push({name:"deliveries"});this.spinnerButton=!1}},async mounted(){let e=this.$loading.show({container:document.querySelector(".container-check"),canCancel:!1,color:"rgb(27, 209, 155)",height:"40",onCancel:this.onCancel}),t=await this.getRoute();void 0!==t&&(null!==t.startDate?(this.isStarted=!0,this.startDate=t.startDate.split("T")[0],this.vehicle=t.vehicle,this.deliveriesAmount=t.deliveriesAmount,this.startHour=t.startHour):(this.vehicle=t.vehicle,this.deliveriesAmount=t.deliveriesAmount,this.startDate=this.actualDate().split(" ")[0],this.startHour=this.actualDate().split(" ")[1]),e.hide())}};const Q=(0,r.Z)(X,[["render",H],["__scopeId","data-v-73b40d9e"]]);var ee=Q;const te={class:"clients-back d-flex justify-content-between align-items-center"},ae={class:"mx-3"},se=(0,o.Uk)(" Ver mapa "),oe={class:"container-user mt-5 mx-3"},ne={id:"toolbar",class:"alert-primary p-3 d-flex justify-content-between toolbar"};function re(e,t,a,n,r,i){const l=(0,o.up)("RowBack"),c=(0,o.up)("router-link"),d=(0,o.up)("Delivery");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",te,[(0,o._)("div",ae,[(0,o.Wm)(l,{back:"route"})]),(0,o.Wm)(c,{class:"mx-4 my-0",to:{name:"multiMap"}},{default:(0,o.w5)((()=>[se])),_:1})]),(0,o._)("div",oe,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.deliveries,(e=>((0,o.wg)(),(0,o.j4)(d,{key:e.idDelivery,delivery:e},null,8,["delivery"])))),128))]),(0,o._)("div",ne,[(0,o._)("span",null,"Entregas: "+(0,m.zw)(r.deliveries.length),1),(0,o._)("span",null,"Gestionadas: "+(0,m.zw)(i.lengthManaged),1)]),(0,o.wy)((0,o._)("div",{class:"fixed-bottom alert-danger w-100 py-3 text-center"},(0,m.zw)(r.error),513),[[s.F8,0!=r.error]])])}const ie=e=>((0,o.dD)("data-v-7cf08e5f"),e=e(),(0,o.Cn)(),e),le={class:"code"},ce={class:"d-flex justify-content-between align-items-center w-100"},de={class:"price text-secondary"},me={class:"direction my-2"},ue=ie((()=>(0,o._)("i",{class:"fa-solid fa-location-dot"},null,-1))),pe={class:"name"},he=ie((()=>(0,o._)("i",{class:"fa-solid fa-user"},null,-1))),ge={class:"time d-flex flex-column mt-2"},ve={class:"text-secondary align-self-end"};function fe(e,t,a,s,n,r){return(0,o.wg)(),(0,o.iD)("div",{class:(0,m.C_)([{disabled:a.delivery.managed},"user"]),onClick:t[0]||(t[0]=e=>r.href(a.delivery.idDelivery))},[(0,o._)("div",le,[(0,o._)("i",{class:(0,m.C_)([a.delivery.managed?"fa-solid":"fa-regular","fa-circle-check text-success"])},null,2),(0,o._)("div",ce,[(0,o._)("p",null,(0,m.zw)(a.delivery.idDelivery),1),(0,o._)("small",de,"s/."+(0,m.zw)(0==a.delivery.price?"x":a.delivery.price),1)])]),(0,o._)("div",me,[ue,(0,o._)("p",null,(0,m.zw)(a.delivery.client.address),1)]),(0,o._)("div",pe,[he,(0,o._)("p",null,(0,m.zw)(a.delivery.client.name),1)]),(0,o._)("div",ge,[(0,o._)("small",ve,(0,m.zw)(a.delivery.destination_time),1)])],2)}var _e={props:["delivery"],name:"deliveryComponent",methods:{href(e){localStorage.setItem("deliveryId",e),this.$router.push({name:"handle"})}}};const ye=(0,r.Z)(_e,[["render",fe],["__scopeId","data-v-7cf08e5f"]]);var we=ye,be={components:{Delivery:we,RowBack:Y},data(){return{data:{},deliveries:[],error:!1}},methods:{async getDeliveries(){try{const e="https://worktrack.apalworkflow.com/server/deliveries";let t=await fetch(e,{headers:{Authorization:"Bearer "+localStorage.getItem("token_user")}}),a=await t.json();return a}catch(e){this.error=`Error al obtener entregas: ${e}`}}},computed:{lengthManaged(){return this.deliveries.filter((e=>e.managed)).length}},async mounted(){let e=this.$loading.show({container:this.fullPage?null:this.$refs.formContainer,canCancel:!1,color:"rgb(27, 209, 155)",height:"40",onCancel:this.onCancel});const t=await this.getDeliveries();"undefined"!==typeof t&&(console.log(t),this.deliveries=t,e.hide())}};const ke=(0,r.Z)(be,[["render",re],["__scopeId","data-v-0f05c7d2"]]);var Ce=ke;const Se={class:"container"};function Ie(e,t,a,s,n,r){const i=(0,o.up)("RowBack"),l=(0,o.up)("ClientsMap");return(0,o.wg)(),(0,o.iD)("div",Se,[(0,o.Wm)(i,{back:"clients"}),(0,o.Wm)(l,{coords:n.coords},null,8,["coords"])])}const xe=e=>((0,o.dD)("data-v-53872399"),e=e(),(0,o.Cn)(),e),De={class:"container-map d-flex flex-column justify-content-between"},Ee=xe((()=>(0,o._)("div",{id:"map",class:"map"},null,-1))),Me={key:0,class:"no_coords"},Te=xe((()=>(0,o._)("p",{class:"text-warning m-0 my-1"},[(0,o._)("i",{class:"fas fa-exclamation-triangle mr-2"}),(0,o.Uk)("Clientes sin geolocalizacion ")],-1))),Oe={class:"list-group"},$e=["href"];function Ae(e,t,a,s,n,r){return(0,o.wg)(),(0,o.iD)("div",De,[Ee,n.markers_NO_COORDS.length>0?((0,o.wg)(),(0,o.iD)("div",Me,[Te,(0,o._)("ul",Oe,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.markers_NO_COORDS,(e=>((0,o.wg)(),(0,o.iD)("li",{class:"list-group-item p-0 d-flex justify-content-between",key:e.id},[(0,o._)("span",null,(0,m.zw)(e.name),1),(0,o._)("a",{href:"tel:+51"+e.phone,class:"text-primary"},"Telf: +51 "+(0,m.zw)(e.phone),9,$e)])))),128))])])):(0,o.kq)("",!0)])}var ze=a(5238);const Re=e=>({next:t=>{const a=new e.maps.Marker({position:t,identificador:1});return a},customer:(t,a)=>{let s={identificador:a.id,position:t};const o=new e.maps.Marker(s);return o},operator:t=>{const a=new e.maps.Marker({draggable:!0,title:"Hola",identificador:1,position:t});return a}}),je=e=>({watchPosition:e=>{const t=navigator,a=e=>{console.log(e)};t.geolocation.watchPosition(e,a,{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})},actualPosition:async()=>new Promise((t=>{const a=navigator,s=a=>{let s=new e.maps.LatLng(a.coords.latitude,a.coords.longitude);t(s)},o=e=>{console.log(e)};a.geolocation.getCurrentPosition(s,o,{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}))}),Ne=e=>({label:(e,t)=>{e.setLabel({text:t,color:"white",fontSize:"15px",fontWeight:"bold"})},windows:(t,a,s)=>{const o=`\n      <div>\n        <h6>${a.name}</h6>\n        <hr>\n        <p><b>Dir</b>: ${a.address}</p>\n        <p><b>Tiem</b>: ${a.service_time}</p>\n        <p><b>Telf</b>: <a href="tel:+51 ${a.phone}">+51 ${a.phone}</a></p>\n      </div> \n    `,n=new e.maps.InfoWindow({content:o});t.addListener("click",(()=>{n.open({anchor:t,map:s,shouldFocus:!1})}))}}),Be=e=>{e=e.filter((e=>!e.status)),e=e.filter((e=>0!=e.lng));let t=Math.min(...e.map((e=>e.service_time))),a=e.find((e=>e.service_time==t));return a},Le=(e,t,a,s)=>{let o={origin:e.getPosition(),destination:t.getPosition(),optimizeWaypoints:!0,travelMode:s.maps.TravelMode.DRIVING},n=new s.maps.DirectionsService,r=new s.maps.DirectionsRenderer({map:a,draggable:!0,suppressMarkers:!0,preserveViewport:!0});n.route(o,((e,t)=>{"OK"==t?r.setDirections(e):console.log("ROUTE_ERROR: ",t)})),e.addListener("position_changed",(()=>{o.origin=e.getPosition(),n.route(o,((e,t)=>{"OK"==t&&r.setDirections(e)}))}))};var Pe={props:["coords"],data(){return{marker:null,geolocation:null,info:null,map:null,google:null,markers:[],markers_NO_COORDS:[]}},async mounted(){let e=this.$loading.show({container:this.fullPage?null:this.$refs.formContainer,canCancel:!1,color:"rgb(27, 209, 155)",height:"40",onCancel:this.onCancel});const t=new ze.a("AIzaSyA2IbChNdPo9LL9fHzSHIR4oyXH7ZjyPUs",{});this.google=await t.load(),this.map=new this.google.maps.Map(document.getElementById("map"),{zoom:18,center:{lat:-12.03600510418158,lng:-77.04066137432721}}),this.marker=Re(this.google),this.geolocation=je(this.google),this.info=Ne(this.google);let a=await this.geolocation.actualPosition(),s=this.marker.operator(a);this.info.label(s,"TÃº"),s.setMap(this.map),this.markers.push(s),this.setCustomersMarkers(this.$props.coords),this.map.setCenter(a);let o=Be(this.$props.coords);if(!o)return console.log("ENTREGAS YA GESTIONADAS!"),void e.hide();let n=this.markers.find((e=>e.identificador==o.id));Le(s,n,this.map,this.google),this.geolocation.watchPosition((e=>{s.setPosition(new this.google.maps.LatLng(e.coords.latitude,e.coords.longitude)),Le(s,n,this.map,this.google)}),(e=>{console.log("WATCH_POSITION_ERROR: ",e)})),e.hide()},methods:{setCustomersMarkers(e){for(const t of e){if(0==t.lat||0==t.lng){this.markers_NO_COORDS.push(t);continue}let e=new this.google.maps.LatLng(t.lat,t.lng),a=this.marker.customer(e,t);if(a.setMap(this.map),t.status){let e="En Ruta"==t.status||"Entrega Parcial"==t.status?t.status.split(" ")[1][0]:t.status[0];this.info.label(a,e)}else this.info.label(a,t.service_time);this.info.windows(a,t),this.markers.push(a)}}}};const Ue=(0,r.Z)(Pe,[["render",Ae],["__scopeId","data-v-53872399"]]);var Fe=Ue,Ge={components:{ClientsMap:Fe,RowBack:Y},data(){return{idDelivery:localStorage.getItem("selected-delivery"),coords:[]}},mounted(){this.$store.state.hideNav=!0;const e=JSON.parse(localStorage.getItem("deliveries"));this.coords=e.map((e=>({id:e.compra.cliente.id,lat:Number(e.compra.cliente.latitud),lng:Number(e.compra.cliente.longitud),name:e.compra.cliente.nombre,address:e.compra.cliente.direccion,status:e.gestion,service_time:e.tiempo_servicio,phone:e.compra.cliente.telefono})))}};const We=(0,r.Z)(Ge,[["render",Ie]]);var He=We;const Ze={class:"container-management"};function Ve(e,t,a,s,n,r){const i=(0,o.up)("Nav"),l=(0,o.up)("router-view");return(0,o.wg)(),(0,o.iD)("div",Ze,[(0,o.Wm)(i),(0,o.Wm)(l)])}const qe={key:0},Je=(0,o.Uk)("GESTION"),Ke=(0,o.Uk)("INFORMACION");function Ye(e,t,a,s,n,r){const i=(0,o.up)("router-link");return e.$store.state.hideNav?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("nav",qe,[(0,o._)("ul",null,[(0,o._)("li",{onClick:t[1]||(t[1]=e=>n.whoBorder="g"),class:(0,m.C_)(["h6",{"border-bottom":"g"==n.whoBorder}])},[(0,o.Wm)(i,{onClick:t[0]||(t[0]=e=>n.whoBorder="g"),to:{name:"handle"}},{default:(0,o.w5)((()=>[Je])),_:1})],2),(0,o._)("li",{onClick:t[3]||(t[3]=e=>n.whoBorder="i"),class:(0,m.C_)(["h6",{"border-bottom":"i"==n.whoBorder}])},[(0,o.Wm)(i,{onClick:t[2]||(t[2]=e=>n.whoBorder="i"),to:{name:"info"}},{default:(0,o.w5)((()=>[Ke])),_:1})],2)])]))}var Xe={name:"NavManagement",data(){return{whoBorder:"g"}},methods:{}};const Qe=(0,r.Z)(Xe,[["render",Ye],["__scopeId","data-v-6088ef9c"]]);var et=Qe,tt={components:{Nav:et}};const at=(0,r.Z)(tt,[["render",Ve]]);var st=at;const ot=e=>((0,o.dD)("data-v-5cf3dc8e"),e=e(),(0,o.Cn)(),e),nt={class:"user"},rt={class:"destinatario"},it={class:"mb-3 d-flex justify-content-between align-items-center w-75"},lt=ot((()=>(0,o._)("i",{class:"fa fa-arrow-left","aria-hidden":"true"},null,-1))),ct=ot((()=>(0,o._)("p",{class:"mx-2 m-0"},"Destinatario",-1))),dt={class:"destinatario-code text-secondary"},mt={class:"h6 destinatario-name"},ut={class:"items"},pt={class:"item"},ht=ot((()=>(0,o._)("p",{class:"h6"},"Items",-1))),gt={class:"formulario"},vt=ot((()=>(0,o._)("h5",{class:"my-0"},"Confirmar gestion",-1))),ft=ot((()=>(0,o._)("i",{class:"fa-solid fa-check-double"},null,-1))),_t=[vt,ft];function yt(e,t,a,n,r,i){const l=(0,o.up)("router-link"),c=(0,o.up)("ManagementStatus"),d=(0,o.up)("ManagementConfirm");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",nt,[(0,o._)("div",rt,[(0,o._)("div",it,[(0,o.Wm)(l,{class:"",to:{name:"deliveries"}},{default:(0,o.w5)((()=>[lt])),_:1}),ct,(0,o._)("span",dt,(0,m.zw)(r.client.id),1)]),(0,o._)("span",mt,(0,m.zw)(r.client.name),1)])]),(0,o.Wm)(c),(0,o.Wm)(l,{class:(0,m.C_)([{disabled:r.itemsManaged},"nav-link p-0"]),to:{name:"items"}},{default:(0,o.w5)((()=>[(0,o._)("div",ut,[(0,o._)("div",pt,[ht,(0,o._)("span",null,(0,m.zw)(r.itemsAmount)+" bultos",1)]),(0,o._)("i",{class:(0,m.C_)({"fa-solid fa-chevron-right text-success":!r.itemsManaged,"fa-circle-check text-success fa-solid":r.itemsManaged})},null,2)])])),_:1},8,["class"]),(0,o.Wm)(l,{class:(0,m.C_)([{disabled:!e.ACCESS_FORM[e.subStatus]||r.evidenced},"nav-link p-0"]),to:{name:"form"}},{default:(0,o.w5)((()=>[(0,o._)("div",gt,[(0,o._)("h6",null,(0,m.zw)(r.evidenced?"Evidencia enviada":e.ACCESS_FORM[e.subStatus]?"Formulario disponible":"Formulario no disponible"),1),(0,o._)("i",{class:(0,m.C_)(r.evidenced?"fa-circle-check text-success fa-solid":e.ACCESS_FORM[e.subStatus]?"fa-solid fa-chevron-right text-success":"fa-solid fa-ban")},null,2)])])),_:1},8,["class"]),(0,o._)("button",{class:(0,m.C_)(["btnConfirmar",{btnDisabled:0!=e.SUB_STATUS[e.status].length&&"Seleccionar sub estado"==e.subStatus}]),"data-toggle":"modal",style:(0,m.j5)({"background-color":e.COLOR[e.status]}),"data-target":"#modalConfirmarGestion"},_t,6),(0,o.Wm)(d,{onError:i.emitError},null,8,["onError"]),(0,o.wy)((0,o._)("div",{class:"fixed-bottom alert-danger w-100 py-3 text-center"},(0,m.zw)(r.error),513),[[s.F8,0!=r.error]])])}var wt=a(65);const bt={class:"modal fade",id:"modalConfirmarGestion",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalCenterTitle","aria-hidden":"true"},kt={class:"modal-dialog modal-dialog-centered",role:"document"},Ct={class:"modal-content"},St=(0,o._)("div",{class:"modal-body"},[(0,o._)("h5",{class:""},"Â¿Desea confirmar esta entrega?"),(0,o._)("span",null,"Esto implica ya no volver a gestionar esta entrega")],-1),It={class:"modal-footer d-flex justify-content-evenly"},xt=(0,o.Uk)(" Confirmar "),Dt=(0,o._)("button",{type:"button",class:"btn btn-secondary btn-sm","data-dismiss":"modal"}," Cancelar ",-1);function Et(e,t,a,s,n,r){return(0,o.wg)(),(0,o.iD)("div",bt,[(0,o._)("div",kt,[(0,o._)("div",Ct,[St,(0,o._)("div",It,[(0,o._)("button",{type:"button",class:"btn btn-primary btn-sm rounded text-white",onClickOnce:t[0]||(t[0]=(...e)=>r.manage&&r.manage(...e)),"data-dismiss":"modal"},[(0,o._)("span",{class:(0,m.C_)(["spinner-border spinner-border-sm mx-1",n.spinnerButton?"":"d-none"]),role:"status","aria-hidden":"true"},null,2),xt],32),Dt])])])])}var Mt={data(){return{spinnerButton:!1,managementDate:this.actualDate(),deliveryId:localStorage.getItem("deliveryId")}},computed:{...(0,wt.rn)(["status","subStatus"])},methods:{actualDate(){const e=new Date,t=60*e.getTimezoneOffset()*1e3,a=new Date(e.getTime()-t),s=a.toISOString().slice(0,19).replace(/-/g,"-").replace("T"," ");return s},async putDeliveryDetails(){try{let e="Seleccionar sub estado"==this.subStatus?null:this.subStatus;const t=`https://worktrack.apalworkflow.com/server/deliveryDetails/${this.deliveryId}`;let a=await fetch(t,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token_user")},body:JSON.stringify({section:"managed",data:{status:this.status,subStatus:e,fecha:this.managementDate,idEntrega:this.deliveryId}})}),s=await a.json();return s}catch(e){this.$emit("error",e)}},async manage(){this.spinnerButton=!0;let e=await this.putDeliveryDetails();"undefined"!==typeof e&&(null!==e&&(this.$router.push({name:"deliveries"}),console.log(e)),this.spinnerButton=!1)}}};const Tt=(0,r.Z)(Mt,[["render",Et]]);var Ot=Tt;function $t(e,t,a,n,r,i){const l=(0,o.up)("StatusModal"),c=(0,o.up)("SubStatusModal");return(0,o.wg)(),(0,o.iD)("div",{class:"container-status",style:(0,m.j5)({"background-color":e.$store.state.COLOR[e.$store.state.status]})},[(0,o.wy)((0,o._)("input",{class:"btn btn-status text-left",type:"text","onUpdate:modelValue":t[0]||(t[0]=t=>e.$store.state.status=t),readonly:"","data-toggle":"modal","data-target":"#modalStatus"},null,512),[[s.nr,e.$store.state.status]]),(0,o.wy)((0,o._)("input",{class:(0,m.C_)(["btn btn-status text-left",0==e.$store.state.SUB_STATUS[e.$store.state.status].length?"subDisabled":""]),type:"text","onUpdate:modelValue":t[1]||(t[1]=t=>e.$store.state.subStatus=t),readonly:"","data-toggle":"modal","data-target":"#modalSubStatus"},null,2),[[s.nr,e.$store.state.subStatus]]),(0,o.Wm)(l),(0,o.Wm)(c,{status:e.$store.state.SUB_STATUS[e.$store.state.status]},null,8,["status"])],4)}const At={class:"modal fade",id:"modalStatus",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalCenterTitle","aria-hidden":"true"},zt={class:"modal-dialog modal-dialog-centered",role:"document"},Rt={class:"modal-content"},jt={class:"modal-body content"},Nt=(0,o._)("div",{class:"text-center"},[(0,o._)("button",{type:"button",class:"btn","data-dismiss":"modal"},"Close")],-1);function Bt(e,t,a,s,n,r){return(0,o.wg)(),(0,o.iD)("div",At,[(0,o._)("div",zt,[(0,o._)("div",Rt,[(0,o._)("div",jt,[(0,o._)("p",{"data-dismiss":"modal",onClick:t[0]||(t[0]=t=>e.setStatus("En Ruta"))},"En Ruta"),(0,o._)("p",{"data-dismiss":"modal",onClick:t[1]||(t[1]=t=>e.setStatus("Entregado"))},"Entregado"),(0,o._)("p",{"data-dismiss":"modal",onClick:t[2]||(t[2]=t=>e.setStatus("No Entregado"))}," No Entregado "),(0,o._)("p",{"data-dismiss":"modal",onClick:t[3]||(t[3]=t=>e.setStatus("Entrega Parcial"))}," Entrega Parcial "),(0,o._)("p",{"data-dismiss":"modal",onClick:t[4]||(t[4]=t=>e.setStatus("Devoluciones Programadas"))}," Devoluciones Programadas ")]),Nt])])])}var Lt={methods:{...(0,wt.OI)(["setStatus"])}};const Pt=(0,r.Z)(Lt,[["render",Bt]]);var Ut=Pt;const Ft={class:"modal fade",id:"modalSubStatus",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalCenterTitle","aria-hidden":"true"},Gt={class:"modal-dialog modal-dialog-centered",role:"document"},Wt={class:"modal-content"},Ht={class:"modal-body content"},Zt=["onClick"],Vt=(0,o._)("div",{class:"text-center"},[(0,o._)("button",{type:"button",class:"btn","data-dismiss":"modal"},"Close")],-1);function qt(e,t,a,s,n,r){return(0,o.wg)(),(0,o.iD)("div",Ft,[(0,o._)("div",Gt,[(0,o._)("div",Wt,[(0,o._)("div",Ht,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(a.status,(t=>((0,o.wg)(),(0,o.iD)("p",{key:t,"data-dismiss":"modal",onClick:a=>e.setSubStatus(t)},(0,m.zw)(t),9,Zt)))),128))]),Vt])])])}var Jt={props:["status"],methods:{...(0,wt.OI)(["setSubStatus"])}};const Kt=(0,r.Z)(Jt,[["render",qt]]);var Yt=Kt,Xt={components:{StatusModal:Ut,SubStatusModal:Yt},data(){return{}}};const Qt=(0,r.Z)(Xt,[["render",$t],["__scopeId","data-v-0213954e"]]);var ea=Qt,ta={components:{ManagementConfirm:Ot,ManagementStatus:ea},data(){return{deliveryId:localStorage.getItem("deliveryId"),managed:!0,itemsManaged:!0,evidenced:!0,client:{id:"...",name:"..."},itemsAmount:"...",error:!1}},computed:{...(0,wt.rn)(["COLOR","ACCESS_FORM","SUB_STATUS","status","subStatus"])},methods:{async getDeliveryDetails(){try{const e=`https://worktrack.apalworkflow.com/server/deliveryDetails/${this.deliveryId}`;let t=await fetch(e,{headers:{Authorization:"Bearer "+localStorage.getItem("token_user")}}),a=await t.json();return a}catch(e){this.error=`Error al obtener detalle de entrega: ${e}`}},emitError(e){this.error=`Error al confirmar gestion: ${e}`},validateManaged(e){e&&this.$router.push({name:"deliveries"})}},async mounted(){let e=this.$loading.show({container:!1,canCancel:!1,color:"rgb(27, 209, 155)",height:"40",onCancel:this.onCancel});this.$store.state.hideNav=!1;const t=await this.getDeliveryDetails();"undefined"!==typeof t&&(null!==t?(this.managed=t.managed,this.validateManaged(this.managed),this.itemsManaged=t.itemsManaged,this.evidenced=t.evidenced,this.client=t.client,this.itemsAmount=t.itemsAmount,e.hide()):(alert("DeliveryId desconocido"),console.log("DeliveryId desconocido")))}};const aa=(0,r.Z)(ta,[["render",yt],["__scopeId","data-v-5cf3dc8e"]]);var sa=aa;const oa={class:"container"},na={class:"items"},ra={key:0,"data-toggle":"modal","data-target":"#modalConfirmarGestionItems",class:"btn-confirmar btn bg-primary w-100 flex-grow-1 text-white"};function ia(e,t,a,n,r,i){const l=(0,o.up)("RowBack"),c=(0,o.up)("Item"),d=(0,o.up)("ItemConfirm"),u=(0,o.up)("ModifyItemModal");return(0,o.wg)(),(0,o.iD)("div",oa,[(0,o.Wm)(l,{back:"handle"}),(0,o._)("div",na,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.items,(e=>((0,o.wg)(),(0,o.j4)(c,{key:e.id,item:e},null,8,["item"])))),128))]),r.VIEW_BUTTON_ITEM[e.status]?((0,o.wg)(),(0,o.iD)("button",ra," Finalizar ")):(0,o.kq)("",!0),(0,o.Wm)(d,{onError:i.emitError},null,8,["onError"]),r.ACCESS_MODAL[e.status]?((0,o.wg)(),(0,o.j4)(u,{key:1,onRefresh:i.refresh,onError:i.emitError},null,8,["onRefresh","onError"])):(0,o.kq)("",!0),(0,o.wy)((0,o._)("div",{class:"fixed-bottom alert-danger w-100 py-3 text-center"},(0,m.zw)(r.error),513),[[s.F8,0!=r.error]])])}const la={class:"name"},ca={class:"code mt-2"},da={class:"digit"};function ma(e,t,a,s,n,r){return(0,o.wg)(),(0,o.iD)("div",{class:"item mb-4","data-toggle":"modal","data-target":"#modifyModal",onClick:t[0]||(t[0]=t=>e.setDatatItem({id:a.item.id,given:a.item.given,ordered:a.item.ordered}))},[(0,o._)("div",null,[(0,o._)("p",la,(0,m.zw)(a.item.name),1),(0,o._)("p",ca,(0,m.zw)(a.item.id),1)]),(0,o._)("p",da,[(0,o._)("span",{class:(0,m.C_)({"text-success h6":a.item.given>0})},(0,m.zw)(a.item.given),3),(0,o.Uk)("/"+(0,m.zw)(a.item.ordered),1)])])}var ua={name:"ItemDelivery",props:["item"],computed:{...(0,wt.rn)(["datatItem"])},methods:{...(0,wt.OI)(["setDatatItem"])}};const pa=(0,r.Z)(ua,[["render",ma],["__scopeId","data-v-b1ae3e3a"]]);var ha=pa;const ga=e=>((0,o.dD)("data-v-32a97fbc"),e=e(),(0,o.Cn)(),e),va={class:"modal fade",id:"modifyModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalCenterTitle","aria-hidden":"true"},fa={class:"modal-dialog modal-dialog-centered",role:"document"},_a={class:"modal-content"},ya={class:"modal-body"},wa={class:"code"},ba={class:"modify"},ka=ga((()=>(0,o._)("p",{class:"h6"},"Entregados",-1))),Ca={class:"quantity"},Sa={class:"num"},Ia={class:"d-flex w-100 justify-content-around"},xa=ga((()=>(0,o._)("button",{type:"button",class:"btn","data-dismiss":"modal"},"Cerrar",-1)));function Da(e,t,a,s,n,r){return(0,o.wg)(),(0,o.iD)("div",va,[(0,o._)("div",fa,[(0,o._)("div",_a,[(0,o._)("div",ya,[(0,o._)("div",wa,[(0,o._)("span",null,"CÃ³d: "+(0,m.zw)(e.dataItem.id),1)]),(0,o._)("div",ba,[ka,(0,o._)("div",Ca,[(0,o._)("i",{class:"fa-solid fa-circle-minus",onClick:t[0]||(t[0]=(...t)=>e.decrementGiven&&e.decrementGiven(...t))}),(0,o._)("div",Sa,[(0,o._)("span",null,(0,m.zw)(e.dataItem.given),1),(0,o._)("span",null,(0,m.zw)(e.dataItem.ordered),1)]),(0,o._)("i",{class:"fa-solid fa-circle-plus",onClick:t[1]||(t[1]=(...t)=>e.incrementGiven&&e.incrementGiven(...t))})])])]),(0,o._)("div",Ia,[xa,(0,o._)("button",{type:"button",class:"btn text-primary","data-dismiss":"modal",onClick:t[2]||(t[2]=(...e)=>r.deliveryItem&&r.deliveryItem(...e))}," Guardar ")])])])])}var Ea={data(){return{deliveryId:localStorage.getItem("deliveryId")}},computed:{...(0,wt.rn)(["dataItem"])},methods:{...(0,wt.OI)(["decrementGiven","incrementGiven"]),async putDeliveryItems(){try{if(this.dataItem.given<=0)return;const e=`https://worktrack.apalworkflow.com/server/deliveryItems/${this.deliveryId}`;let t=await fetch(e,{method:"put",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token_user")},body:JSON.stringify({cantidad:this.dataItem.given,idItem:this.dataItem.id})}),a=await t.json();return a}catch(e){this.$emit("error",e)}},async deliveryItem(){let e=this.$loading.show({container:!1,canCancel:!1,backgroundColor:"#ececec",color:"rgb(27, 209, 155)",height:"25",onCancel:!1}),t=await this.putDeliveryItems();console.log(t),"undefined"!==typeof t&&null!==t&&(e.hide(),location.reload())}}};const Ma=(0,r.Z)(Ea,[["render",Da],["__scopeId","data-v-32a97fbc"]]);var Ta=Ma;const Oa=e=>((0,o.dD)("data-v-153f7788"),e=e(),(0,o.Cn)(),e),$a={class:"modal fade",id:"modalConfirmarGestionItems",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalCenterTitle","aria-hidden":"true"},Aa={class:"modal-dialog modal-dialog-centered",role:"document"},za={class:"modal-content"},Ra=Oa((()=>(0,o._)("div",{class:"modal-body"},[(0,o._)("h5",{class:""},"Â¿Desea finalizar la gestion de items?"),(0,o._)("span",null,"Esto implica ya no volver a gestionarlos luego")],-1))),ja={class:"modal-footer d-flex justify-content-evenly"},Na=(0,o.Uk)(" Confirmar "),Ba=Oa((()=>(0,o._)("button",{type:"button",class:"btn btn-secondary btn-sm","data-dismiss":"modal"}," Cancelar ",-1)));function La(e,t,a,s,n,r){return(0,o.wg)(),(0,o.iD)("div",$a,[(0,o._)("div",Aa,[(0,o._)("div",za,[Ra,(0,o._)("div",ja,[(0,o._)("button",{class:"btn btn-primary btn-sm rounded text-white",onClick:t[0]||(t[0]=(...e)=>r.manage&&r.manage(...e)),"data-dismiss":"modal"},[(0,o._)("span",{class:(0,m.C_)(["spinner-border spinner-border-sm mx-1",n.spinnerButton?"":"d-none"]),role:"status","aria-hidden":"true"},null,2),Na]),Ba])])])])}var Pa={data(){return{spinnerButton:!1,fecha:this.actualDate(),deliveryId:localStorage.getItem("deliveryId")}},methods:{actualDate(){const e=new Date,t=60*e.getTimezoneOffset()*1e3,a=new Date(e.getTime()-t),s=a.toISOString().slice(0,19).replace(/-/g,"-").replace("T"," ");return s},async getDeliveryDetails(){try{const e=`https://worktrack.apalworkflow.com/server/deliveryDetails/${this.deliveryId}`;let t=await fetch(e,{headers:{Authorization:"Bearer "+localStorage.getItem("token_user")}}),a=await t.json();return a}catch(e){this.error=`Error al obtener detalle de entrega: ${e}`}},validateManaged(e){e&&this.$router.push({name:"deliveries"})},validateItemsManaged(e){e&&this.$router.push({name:"handle"})},async putDeliveryDetails(){try{const e=`https://worktrack.apalworkflow.com/server/deliveryDetails/${this.deliveryId}`;let t=await fetch(e,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token_user")},body:JSON.stringify({section:"itemsManaged",data:{fecha:this.fecha,idEntrega:this.deliveryId}})}),a=await t.json();return a}catch(e){this.$emit("error",e)}},async manage(){this.spinnerButton=!0;let e=await this.putDeliveryDetails();"undefined"!==typeof e&&(null!==e&&this.$router.push({name:"handle"}),this.spinnerButton=!1)}},async mounted(){let e=this.$loading.show({container:!1,canCancel:!1,color:"rgb(27, 209, 155)",height:"40",onCancel:this.onCancel});const t=await this.getDeliveryDetails();"undefined"!==typeof t&&(null!==t?(this.validateManaged(t.managed),this.validateItemsManaged(t.itemsManaged),e.hide()):(alert("DeliveryId desconocido"),console.log("DeliveryId desconocido")))}};const Ua=(0,r.Z)(Pa,[["render",La],["__scopeId","data-v-153f7788"]]);var Fa=Ua,Ga={name:"ManagementItems",data(){return{deliveryId:localStorage.getItem("deliveryId"),items:[],error:!1,ACCESS_MODAL:{"En Ruta":!1,Entregado:!1,"No Entregado":!1,"Entrega Parcial":!0,"Devoluciones Programadas":!0},VIEW_BUTTON_ITEM:{"En Ruta":!0,Entregado:!1,"No Entregado":!0,"Entrega Parcial":!0,"Devoluciones Programadas":!0}}},components:{RowBack:Y,Item:ha,ModifyItemModal:Ta,ItemConfirm:Fa},computed:{...(0,wt.rn)(["status"])},methods:{async getItems(){try{const e=`https://worktrack.apalworkflow.com/server/deliveryItems/${this.deliveryId}`;let t=await fetch(e,{headers:{Authorization:"Bearer "+localStorage.getItem("token_user")}}),a=await t.json();return a}catch(e){this.error=`Error al obtener items: ${e}`}},emitError(e){this.error=`Error al confirmar en items: ${e}`},refresh(){const e=localStorage.getItem("selected-delivery");this.items=this.searchItemsByIdDelivery(e)},searchItemsByIdDelivery(e){const t=JSON.parse(localStorage.getItem("deliveries"));for(const a of t)if(a.id==e)return a.compra.items}},async mounted(){let e=this.$loading.show({container:this.fullPage?null:this.$refs.formContainer,canCancel:!1,color:"rgb(27, 209, 155)",height:"40",onCancel:this.onCancel});this.$store.state.hideNav=!0;const t=await this.getItems();"undefined"!==typeof t&&null!==t&&(this.items=t,console.log(t),e.hide())}};const Wa=(0,r.Z)(Ga,[["render",ia],["__scopeId","data-v-a312a032"]]);var Ha=Wa;const Za=e=>((0,o.dD)("data-v-0b4124b3"),e=e(),(0,o.Cn)(),e),Va={class:"container"},qa={class:"addressee card p-3 mb-3 mt-3"},Ja=Za((()=>(0,o._)("span",null,"Destinatario",-1))),Ka={class:"h6 mt-2 mb-5"},Ya={class:"contacts float-right align-self-end d-flex justify-content-between"},Xa=["href"],Qa=Za((()=>(0,o._)("i",{class:"fa-solid fa-phone"},null,-1))),es=Za((()=>(0,o._)("span",null,"Llamar",-1))),ts=[Qa,es],as=Za((()=>(0,o._)("div",{class:"notify text-primary d-flex align-items-center","data-toggle":"modal","data-target":"#modalNotify"},[(0,o._)("i",{class:"fa-solid fa-bell"}),(0,o._)("span",null,"Notificar")],-1))),ss={class:"card extra p-3"},os={class:"manager position-relative"},ns={class:"d-flex align-items-center"},rs=Za((()=>(0,o._)("span",null,"Gestor",-1))),is={class:"mx-3 code h6 my-0"},ls={class:"d-block font-weight-bold mt-2 mb-3 name"},cs=["href"],ds=Za((()=>(0,o._)("i",{class:"fa-solid fa-phone"},null,-1))),ms=Za((()=>(0,o._)("span",null,"Llamar",-1))),us=[ds,ms],ps=["href"],hs=Za((()=>(0,o._)("i",{class:"fa-brands fa-whatsapp"},null,-1))),gs=Za((()=>(0,o._)("span",null,"WhatsApp",-1))),vs=[hs,gs],fs=Za((()=>(0,o._)("hr",null,null,-1))),_s={class:"supervisor position-relative"},ys=Za((()=>(0,o._)("span",null,"Supervisor",-1))),ws={class:"d-block font-weight-bold mt-2 mb-3 name"},bs=["href"],ks=Za((()=>(0,o._)("i",{class:"fa-solid fa-phone"},null,-1))),Cs=Za((()=>(0,o._)("span",null,"Llamar",-1))),Ss=[ks,Cs],Is=["href"],xs=Za((()=>(0,o._)("i",{class:"fa-brands fa-whatsapp"},null,-1))),Ds=Za((()=>(0,o._)("span",null,"WhatsApp",-1))),Es=[xs,Ds],Ms={class:"d-flex delivery-address card p-3 pb-0 mt-3"},Ts=Za((()=>(0,o._)("span",null,"Direccion de entrega",-1))),Os={class:"h6 mt-2 mb-5"},$s=Za((()=>(0,o._)("div",{class:"map text-primary align-self-end d-flex align-items-center"},[(0,o._)("i",{class:"fa-solid fa-diamond-turn-right"}),(0,o._)("a",{href:"singleMap"},"Mapa")],-1)));function As(e,t,a,n,r,i){const l=(0,o.up)("NotifyModal");return(0,o.wg)(),(0,o.iD)("div",Va,[(0,o._)("div",qa,[Ja,(0,o._)("p",Ka,(0,m.zw)(r.addressee.name),1),(0,o._)("div",Ya,[(0,o._)("a",{href:"tel:+51"+r.addressee.phone,class:"call text-primary d-flex align-items-center text-decoration-none"},ts,8,Xa),as])]),(0,o.Wm)(l),(0,o._)("div",ss,[(0,o._)("div",os,[(0,o._)("div",ns,[rs,(0,o._)("small",is,(0,m.zw)(r.manager.cod),1)]),(0,o._)("small",ls,(0,m.zw)(r.manager.name),1),(0,o._)("div",{class:(0,m.C_)([0==Object.keys(r.manager).length||"Ã"==r.manager.phone?"invisible":"visible","contacts float-right align-self-end d-flex justify-content-between"])},[(0,o._)("a",{href:"tel:+51"+r.manager.phone,class:"call text-primary d-flex align-items-center text-decoration-none"},us,8,cs),(0,o._)("a",{href:"https://wa.me/+51"+r.manager.phone+"?text=Enviar mensaje a Gestor",class:"chat text-primary d-flex align-items-center text-decoration-none"},vs,8,ps)],2)]),fs,(0,o._)("div",_s,[ys,(0,o._)("small",ws,(0,m.zw)(r.supervisor.name),1),(0,o._)("div",{class:(0,m.C_)([0==Object.keys(r.supervisor).length||"Ã"==r.supervisor.phone?"invisible":"visible","contacts float-right align-self-end d-flex justify-content-between"])},[(0,o._)("a",{href:"tel:+51"+r.supervisor.phone,class:"call text-primary d-flex align-items-center text-decoration-none"},Ss,8,bs),(0,o._)("a",{href:"https://wa.me/+51"+r.supervisor.phone+"?text=Enviar mensaje a supervisor",class:"chat text-primary d-flex align-items-center text-decoration-none"},Es,8,Is)],2)])]),(0,o._)("div",Ms,[Ts,(0,o._)("p",Os,(0,m.zw)(r.addressee.address),1),$s]),(0,o.wy)((0,o._)("div",{class:"fixed-bottom alert-danger w-100 py-3 text-center"},(0,m.zw)(r.error),513),[[s.F8,0!=r.error]])])}const zs=e=>((0,o.dD)("data-v-5b1c16d2"),e=e(),(0,o.Cn)(),e),Rs={class:"modal fade",id:"modalNotify",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalCenterTitle","aria-hidden":"true"},js={class:"modal-dialog modal-dialog-centered",role:"document"},Ns={class:"modal-header"},Bs={class:"d-flex align-items-center"},Ls=zs((()=>(0,o._)("span",null,"Notificando a: ",-1))),Ps={class:"number-phone mx-2 px-2 py-1 rounded"},Us={class:"modal-body"},Fs={class:"form-group"},Gs=zs((()=>(0,o._)("label",{class:"font-weight-bold"},"ATENCION:",-1))),Ws={class:"custom-control custom-radio"},Hs=zs((()=>(0,o._)("label",{class:"form-check-label",for:"atencion1"}," Estimado Cliente; Llego su pedido solicitado",-1))),Zs={class:"custom-control custom-radio"},Vs=zs((()=>(0,o._)("label",{class:"form-check-label",for:"atencion2"},"Buenos dias; A que hora regresara para poder realizar la entrega de sus productos",-1))),qs={class:"form-group"},Js=zs((()=>(0,o._)("label",{class:"font-weight-bold"},"CLASIFICACION:",-1))),Ks=zs((()=>(0,o._)("label",{class:""},"Estimado Cliente; Como calificaria mi servicio ofrecido",-1))),Ys={class:"custom-control custom-radio"},Xs=zs((()=>(0,o._)("label",{class:"form-check-label",for:"clasificacion1"}," BUENO",-1))),Qs={class:"custom-control custom-radio"},eo=zs((()=>(0,o._)("label",{class:"form-check-label",for:"clasificacion2"},"MALO",-1))),to={class:"custom-control custom-radio"},ao=zs((()=>(0,o._)("label",{class:"form-check-label",for:"clasificacion3"},"REGULAR",-1))),so={class:"custom-control custom-radio"},oo=zs((()=>(0,o._)("label",{class:"form-check-label",for:"clasificacion4"},"SATISFECHO",-1))),no={class:"custom-control custom-radio"},ro=zs((()=>(0,o._)("label",{class:"form-check-label",for:"clasificacion5"},"INSATISFECHO",-1))),io={class:"form-group"},lo=zs((()=>(0,o._)("label",{class:"font-weight-bold"},"DESPEDIDA:",-1))),co={class:"custom-control custom-radio"},mo=zs((()=>(0,o._)("label",{class:"form-check-label",for:"despedida1"}," Hasta otra oportunidad; Esperemos haya sido de su agrado la atencion brindada",-1))),uo=zs((()=>(0,o._)("div",{class:"modal-footer"},[(0,o._)("button",{type:"submit",class:"btn btn-primary"},"Enviar mensaje"),(0,o._)("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"}," Cancelar ")],-1)));function po(e,t,a,n,r,i){return(0,o.wg)(),(0,o.iD)("div",Rs,[(0,o._)("div",js,[(0,o._)("form",{class:"modal-content",onSubmit:t[8]||(t[8]=(0,s.iM)(((...e)=>i.sendMessage&&i.sendMessage(...e)),["prevent"]))},[(0,o._)("div",Ns,[(0,o._)("div",Bs,[Ls,(0,o._)("span",Ps,(0,m.zw)(r.phone),1)])]),(0,o._)("div",Us,[(0,o._)("div",Fs,[Gs,(0,o._)("div",Ws,[(0,o.wy)((0,o._)("input",{id:"atencion1",type:"radio",class:"form-check-input",value:"Estimado Cliente; Llego su pedido solicitado",name:"sms","onUpdate:modelValue":t[0]||(t[0]=e=>r.sms=e)},null,512),[[s.G2,r.sms]]),Hs]),(0,o._)("div",Zs,[(0,o.wy)((0,o._)("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=e=>r.sms=e),id:"atencion2",name:"sms",value:"Buenos dias; A que hora regresara para poder realizar la entrega de sus productos",class:"form-check-input"},null,512),[[s.G2,r.sms]]),Vs])]),(0,o._)("div",qs,[Js,Ks,(0,o._)("div",Ys,[(0,o.wy)((0,o._)("input",{type:"radio","onUpdate:modelValue":t[2]||(t[2]=e=>r.sms=e),id:"clasificacion1",name:"sms",value:"bueno",class:"form-check-input"},null,512),[[s.G2,r.sms]]),Xs]),(0,o._)("div",Qs,[(0,o.wy)((0,o._)("input",{type:"radio","onUpdate:modelValue":t[3]||(t[3]=e=>r.sms=e),id:"clasificacion2",name:"sms",value:"malo",class:"form-check-input"},null,512),[[s.G2,r.sms]]),eo]),(0,o._)("div",to,[(0,o.wy)((0,o._)("input",{type:"radio","onUpdate:modelValue":t[4]||(t[4]=e=>r.sms=e),id:"clasificacion3",name:"sms",value:"regular",class:"form-check-input"},null,512),[[s.G2,r.sms]]),ao]),(0,o._)("div",so,[(0,o.wy)((0,o._)("input",{type:"radio","onUpdate:modelValue":t[5]||(t[5]=e=>r.sms=e),id:"clasificacion4",name:"sms",value:"satisfecho",class:"form-check-input"},null,512),[[s.G2,r.sms]]),oo]),(0,o._)("div",no,[(0,o.wy)((0,o._)("input",{type:"radio","onUpdate:modelValue":t[6]||(t[6]=e=>r.sms=e),id:"clasificacion5",name:"sms",value:"insatisfecho",class:"form-check-input"},null,512),[[s.G2,r.sms]]),ro])]),(0,o._)("div",io,[lo,(0,o._)("div",co,[(0,o.wy)((0,o._)("input",{type:"radio","onUpdate:modelValue":t[7]||(t[7]=e=>r.sms=e),id:"despedida1",name:"sms",value:" Hasta otra oportunidad; Esperemos haya sido de su agrado la atencion brindada",class:"form-check-input"},null,512),[[s.G2,r.sms]]),mo])])]),uo],32)]),(0,o.wy)((0,o._)("div",{class:"fixed-bottom alert-danger w-100 py-3 text-center"},(0,m.zw)(r.error),513),[[s.F8,0!=r.error]])])}var ho={data(){return{idDelivery:localStorage.getItem("selected-delivery"),phone:"",sms:"Estimado Cliente; Llego su pedido solicitado",error:!1}},methods:{async sendMessage(){let e=this.$loading.show({container:!1,canCancel:!1,backgroundColor:"#ececec",color:"rgb(27, 209, 155)",height:"25",onCancel:!1});try{const t="https://worktrack.apalworkflow.com/server/sms";let a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:this.phone,sms:this.sms})}),s=await a.json();200==s.status?alert("Mensaje enviado!!"):alert("Error al enviar mensaje!!"),e.hide()}catch(t){this.error=`Error al enviar sms: ${t}`}}},mounted(){}};const go=(0,r.Z)(ho,[["render",po],["__scopeId","data-v-5b1c16d2"]]);var vo=go,fo={components:{NotifyModal:vo},data(){return{deliveryId:localStorage.getItem("deliveryId"),addressee:{name:"",phone:"",address:""},manager:{},supervisor:{},error:!1}},methods:{async getDeliveryDetails(){try{const e=`https://worktrack.apalworkflow.com/server/deliveryDetails/${this.deliveryId}`;let t=await fetch(e,{headers:{Authorization:"Bearer "+localStorage.getItem("token_user")}}),a=await t.json();return a}catch(e){this.error=`Error al obtener detalle de entrega: ${e}`}},async getManager(e){try{const t=`https://worktrack.apalworkflow.com/server/extraDelivery/manager/${e}`;let a=await fetch(t),s=await a.json();return 0==s.length?{cod:"Ã",name:"Ã",phone:"Ã"}:s[0]}catch(t){this.error+=`Error al obtener gestor: ${t}`}},async getSupervisor(e){try{const t=`https://worktrack.apalworkflow.com/server/extraDelivery/supervisor/${e}`;let a=await fetch(t),s=await a.json();return 0==s.length?{name:"Ã",phone:"Ã"}:s[0]}catch(t){this.error+=`Error al obtener supervisor: ${t}`}}},async mounted(){this.$store.state.hideNav=!1;let e=this.$loading.show({container:document.querySelector(".manager"),canCancel:!1,backgroundColor:"#ececec",color:"rgb(27, 209, 155)",height:"25",onCancel:this.onCancel}),t=this.$loading.show({container:document.querySelector(".supervisor"),canCancel:!1,backgroundColor:"#ececec",color:"rgb(27, 209, 155)",height:"25",onCancel:this.onCancel});const a=await this.getDeliveryDetails();if("undefined"===typeof a)return;null!==a?this.addressee=a.client:(alert("DeliveryId desconocido"),console.log("DeliveryId desconocido"));let s=await this.getManager(this.deliveryId),o=await this.getSupervisor(this.deliveryId);s&&(this.manager=s,e.hide()),o&&(this.supervisor=o,t.hide())}};const _o=(0,r.Z)(fo,[["render",As],["__scopeId","data-v-0b4124b3"]]);var yo=_o;const wo={class:"container"};function bo(e,t,a,s,n,r){const i=(0,o.up)("RowBack"),l=(0,o.up)("ClientMap");return(0,o.wg)(),(0,o.iD)("div",wo,[(0,o.Wm)(i,{back:"management/info"}),(0,o.Wm)(l,{coord:n.coord},null,8,["coord"])])}function ko(e,t,a,s,n,r){const i=(0,o.up)("AnyGeoModal");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",{class:(0,m.C_)([{"d-none":0==a.coord.lat},"map w-100 m-auto"]),id:"map"},null,2),(0,o._)("div",{class:(0,m.C_)({"d-none":0!=a.coord.lat})},[(0,o.Wm)(i)],2)])}const Co=e=>((0,o.dD)("data-v-691af27d"),e=e(),(0,o.Cn)(),e),So={class:"anyGeo py-5 alert-warning d-flex flex-column align-items-center justify-content-center"},Io=Co((()=>(0,o._)("i",{class:"fas fa-exclamation-triangle mr-2 mb-4"},null,-1))),xo=Co((()=>(0,o._)("p",{class:"h5"},"SIN GEOLOCALIZACION",-1))),Do=[Io,xo];function Eo(e,t){return(0,o.wg)(),(0,o.iD)("div",So,Do)}const Mo={},To=(0,r.Z)(Mo,[["render",Eo],["__scopeId","data-v-691af27d"]]);var Oo=To,$o={props:["coord"],components:{AnyGeoModal:Oo},data(){return{info:null}},async mounted(){const e=new ze.a("AIzaSyA2IbChNdPo9LL9fHzSHIR4oyXH7ZjyPUs",{}),t=await e.load(),a=new t.maps.Map(document.getElementById("map"),{zoom:18,center:this.$props.coord}),s=new t.maps.Marker({position:this.$props.coord,map:a});this.info=Ne(t),this.info.label(s,this.$props.coord.service_time),this.info.windows(s,this.$props.coord)}};const Ao=(0,r.Z)($o,[["render",ko],["__scopeId","data-v-279405b6"]]);var zo=Ao,Ro={components:{ClientMap:zo,RowBack:Y},data(){return{idDelivery:localStorage.getItem("selected-delivery"),coord:[]}},mounted(){this.$store.state.hideNav=!0;const e=JSON.parse(localStorage.getItem("deliveries")),t=e.find((e=>e.id==this.idDelivery));this.coord={lat:Number(t.compra.cliente.latitud),lng:Number(t.compra.cliente.longitud),name:t.compra.cliente.nombre,address:t.compra.cliente.direccion,phone:t.compra.cliente.telefono,service_time:t.tiempo_servicio}}};const jo=(0,r.Z)(Ro,[["render",bo]]);var No=jo;const Bo=e=>((0,o.dD)("data-v-35f12157"),e=e(),(0,o.Cn)(),e),Lo={class:"container"},Po={class:"mt-3"},Uo={class:"text-secondary h6 sub-satus"},Fo=Bo((()=>(0,o._)("span",{class:"h5"},"Foto de Local o Producto",-1))),Go=Bo((()=>(0,o._)("i",{id:"icon",class:"fa-solid fa-camera m-auto"},null,-1))),Wo=Bo((()=>(0,o._)("img",{id:"img",class:"d-none",alt:""},null,-1))),Ho=[Go,Wo],Zo={class:"form-group mt-5"},Vo=Bo((()=>(0,o._)("label",{for:""},"Comentario",-1)));function qo(e,t,a,n,r,i){const l=(0,o.up)("RowBack");return(0,o.wg)(),(0,o.iD)("div",Lo,[(0,o.Wm)(l,{back:"management"}),(0,o._)("div",Po,[(0,o._)("p",Uo,(0,m.zw)(e.$store.state.subStatus),1),Fo,(0,o._)("div",{onClick:t[0]||(t[0]=(...e)=>i.activeCamara&&i.activeCamara(...e)),class:"camara mt-3 d-flex align-items-center"},Ho),(0,o._)("div",Zo,[Vo,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>r.comentario=e),type:"text",class:"form-control"},null,512),[[s.nr,r.comentario]])]),(0,o._)("button",{onClick:t[2]||(t[2]=(...e)=>i.sendEvidence&&i.sendEvidence(...e)),class:"btn-confirmar btn bg-primary w-100 flex-grow-1 text-white"}," Finalizar ")]),(0,o._)("input",{onChange:t[3]||(t[3]=(...e)=>i.loadCapture&&i.loadCapture(...e)),id:"importer",class:"invisible",type:"file",accept:"image/*",capture:"camera"},null,32),(0,o.wy)((0,o._)("div",{class:"fixed-bottom alert-danger w-100 py-3 text-center"},(0,m.zw)(r.error),513),[[s.F8,0!=r.error]])])}var Jo={components:{RowBack:Y},data(){return{filePhoto:null,comentario:"",idEntrega:localStorage.getItem("selected-delivery"),error:!1}},methods:{activeCamara(){const e=document.getElementById("importer");e.click()},loadCapture(){const e=document.querySelector(".camara"),t=document.getElementById("importer"),a=document.getElementById("img"),s=document.getElementById("icon");if(0==t.files.length)return;this.filePhoto=t.files[0],a.file=this.filePhoto,a.classList.remove("d-none");let o=new FileReader;o.addEventListener("load",(e=>{a.src=e.target.result})),o.readAsDataURL(this.filePhoto),e.replaceChild(a,s)},async sendPhoto(e){try{const t=`https://worktrack.apalworkflow.com/server/evidence/${this.comentario}/${this.idEntrega}`;let a=new FormData;a.append("file",e);let s=await fetch(t,{method:"POST",body:a}),o=await s.json();return o}catch(t){this.error=`Error al enviar evidencias: ${t}`}},async sendEvidence(){const e=document.getElementById("img");if(""==e.src||""==this.comentario)return void alert("Por favor, completar datos de evidencia!");let t=this.$loading.show({container:!1,canCancel:!1,color:"rgb(27, 209, 155)",height:"40",onCancel:this.onCancel}),a=await this.sendPhoto(this.filePhoto);if(a){if(a.affectedRows>=1){let e=Number(this.idEntrega),t=JSON.parse(localStorage.getItem("deliveries"));for(const a of t)if(a.id==e){a.evidencia=!0;break}localStorage.setItem("deliveries",JSON.stringify(t)),this.$router.push({name:"handle"})}t.hide()}}},mounted(){this.$store.state.hideNav=!0}};const Ko=(0,r.Z)(Jo,[["render",qo],["__scopeId","data-v-35f12157"]]);var Yo=Ko;const Xo=[{path:"/",name:"",component:M},{path:"/route",name:"route",component:ee},{path:"/deliveries",name:"deliveries",component:Ce},{path:"/multiMap",name:"multiMap",component:He},{path:"/management",name:"management",component:st,children:[{path:"handle",name:"handle",component:sa},{path:"info",name:"info",component:yo},{path:"items",name:"items",component:Ha},{path:"singleMap",name:"singleMap",component:No},{path:"form",name:"form",component:Yo}]}],Qo=(0,d.p7)({history:(0,d.PO)("/manage/"),routes:Xo});var en=Qo,tn=a(5103);const an=new tn.Ew({storage:window.localStorage});var sn=(0,wt.MT)({state:{dataItem:{id:0,given:0,ordered:0},hideNav:!1,status:"En Ruta",subStatus:"Seleccionar sub estado",COLOR:{"En Ruta":"#007bff",Entregado:"rgb(27, 209, 155)","No Entregado":"red","Entrega Parcial":"#ffc300","Devoluciones Programadas":"#630ADC"},SUB_STATUS:{"En Ruta":[],Entregado:[],"No Entregado":["TEL01: Local Cerrado","TEL02: Sin Dinero","TEL04: Ausente","TEL05: No hizo pedido","TEL06: Por precio de producto","TEL07: Direccion errada","TEL08: Vencimiento cercano","TEL09: Mercaderia deteriorada","TEL10: Asalto/Robo","TEL11: Fuera de horario","TEL12: Fallas Mecanicas","TEL13: Error de picking","TEL14: Falta de Tiempo","TEL15: Por cambios","TEL16: Exceso de Tiempo de Espera","TEL17: Error de Sistema","TEL18: Error de Geoposicion","TEL19: Error toma de pedido"],"Entrega Parcial":["TEL01: Error toma de pedido","TEL02: Por precio de producto","TEL03: Vencimiento cerano","TEL04: Mercaderia deteriorada","TEL05: Error de picking","TEL06: Por cambios"],"Devoluciones Programadas":["Recojo completo","Recojo parcial","Recojo no efectuado"]},ACCESS_FORM:{"TEL01: Local Cerrado":!0,"TEL19: Error toma de pedido":!0}},getters:{},mutations:{setStatus(e,t){e.status=t,e.subStatus="Seleccionar sub estado"},setSubStatus(e,t){e.subStatus=t},setDatatItem(e,t){e.dataItem=t},incrementGiven(e){e.dataItem.given<e.dataItem.ordered&&e.dataItem.given++},decrementGiven(e){e.dataItem.given>0&&e.dataItem.given--}},actions:{},plugins:[an.plugin]}),on=(a(3455),a(3752)),nn=a.n(on);(0,s.ri)(c).use(sn).use(en).use(nn()).mount("#app")}},t={};function a(s){var o=t[s];if(void 0!==o)return o.exports;var n=t[s]={exports:{}};return e[s].call(n.exports,n,n.exports,a),n.exports}a.m=e,function(){var e=[];a.O=function(t,s,o,n){if(!s){var r=1/0;for(d=0;d<e.length;d++){s=e[d][0],o=e[d][1],n=e[d][2];for(var i=!0,l=0;l<s.length;l++)(!1&n||r>=n)&&Object.keys(a.O).every((function(e){return a.O[e](s[l])}))?s.splice(l--,1):(i=!1,n<r&&(r=n));if(i){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[s,o,n]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};a.O.j=function(t){return 0===e[t]};var t=function(t,s){var o,n,r=s[0],i=s[1],l=s[2],c=0;if(r.some((function(t){return 0!==e[t]}))){for(o in i)a.o(i,o)&&(a.m[o]=i[o]);if(l)var d=l(a)}for(t&&t(s);c<r.length;c++)n=r[c],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(d)},s=self["webpackChunkapal_mobil"]=self["webpackChunkapal_mobil"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=a.O(void 0,[998],(function(){return a(4825)}));s=a.O(s)})();
//# sourceMappingURL=app.5fd48c07.js.map